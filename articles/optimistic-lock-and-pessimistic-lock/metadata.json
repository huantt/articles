{"url":"https://dev.to/jacktt/optimistic-lock-pessimistic-lock-4h36","slug":"optimistic-lock-and-pessimistic-lock","title":"Optimistic lock \u0026 Pessimistic lock","description":"Pessimistic lock    Lock READ UPDATE Unlock   Example:    START TRANSACTION;  -- Select the...","body_markdown":"## Pessimistic lock\n- Lock\n- READ\n- UPDATE\n- Unlock\n\nExample:\n\n```sql\nSTART TRANSACTION;\n\n-- Select the product row for update\nSELECT * FROM products WHERE product_id = 1 FOR UPDATE;\n\n-- Perform operations on the selected data\nUPDATE products \nSET price = 1200,\n  version = version + 1\nWHERE product_id = 1;\n\n-- Commit the transaction\nCOMMIT;\n```\n\n#### PROs:\n- Prevents conflicts.\n- Ensures data integrity.\n- Suitable for high contention.\n\n#### CONs:\n- Decreased throughput.\n- Increased deadlock risk.\n- Reduced responsiveness.\n\n#### Use Case:\nPessimistic locking is often employed in scenarios where conflicts are likely or must be avoided, such as:\n- Banking systems where transactions involving account balances must be processed serially.\n- Reservation systems where concurrent bookings for the same resource must be prevented.\n\n## Optimistic lock\n- READ\n- LOCK\n- UPDATE\n- UNLOCK\n\nExample:\n\n```sql\n-- Check current version of the product\nSELECT version FROM products WHERE product_id = 1;\n\n-- Update product price (assuming version 1)\nUPDATE products\nSET price = 1200.00,\n    version = version + 1\nWHERE product_id = 1 AND version = 1;\n\n-- Retry if update count is zero\n```\n\n#### PROs:\n- Minimal performance impact.\n- Allows concurrent access.\n- Suitable for infrequent conflicts.\n\n#### CONs:\n- Risk of conflicts.\n- Requires conflict resolution. (retry)\n- Not ideal for high contention.\n\n#### Use Case\nOptimistic locking is commonly used in scenarios where the likelihood of conflicts is low, such as:\n\n- Content management systems where users rarely edit the same document simultaneously.\n- E-commerce platforms where product prices are updated infrequently.\n","body_html":"\u003ch2\u003e\n  \u003ca name=\"pessimistic-lock\" href=\"#pessimistic-lock\"\u003e\n  \u003c/a\u003e\n  Pessimistic lock\n\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003eLock\u003c/li\u003e\n\u003cli\u003eREAD\u003c/li\u003e\n\u003cli\u003eUPDATE\u003c/li\u003e\n\u003cli\u003eUnlock\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eExample:\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight sql\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eSTART\u003c/span\u003e \u003cspan class=\"n\"\u003eTRANSACTION\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e-- Select the product row for update\u003c/span\u003e\n\u003cspan class=\"k\"\u003eSELECT\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"k\"\u003eFROM\u003c/span\u003e \u003cspan class=\"n\"\u003eproducts\u003c/span\u003e \u003cspan class=\"k\"\u003eWHERE\u003c/span\u003e \u003cspan class=\"n\"\u003eproduct_id\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"k\"\u003eFOR\u003c/span\u003e \u003cspan class=\"k\"\u003eUPDATE\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e-- Perform operations on the selected data\u003c/span\u003e\n\u003cspan class=\"k\"\u003eUPDATE\u003c/span\u003e \u003cspan class=\"n\"\u003eproducts\u003c/span\u003e \n\u003cspan class=\"k\"\u003eSET\u003c/span\u003e \u003cspan class=\"n\"\u003eprice\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e1200\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eversion\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eversion\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n\u003cspan class=\"k\"\u003eWHERE\u003c/span\u003e \u003cspan class=\"n\"\u003eproduct_id\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e-- Commit the transaction\u003c/span\u003e\n\u003cspan class=\"k\"\u003eCOMMIT\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003ch4\u003e\n  \u003ca name=\"pros\" href=\"#pros\"\u003e\n  \u003c/a\u003e\n  PROs:\n\u003c/h4\u003e\n\n\u003cul\u003e\n\u003cli\u003ePrevents conflicts.\u003c/li\u003e\n\u003cli\u003eEnsures data integrity.\u003c/li\u003e\n\u003cli\u003eSuitable for high contention.\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch4\u003e\n  \u003ca name=\"cons\" href=\"#cons\"\u003e\n  \u003c/a\u003e\n  CONs:\n\u003c/h4\u003e\n\n\u003cul\u003e\n\u003cli\u003eDecreased throughput.\u003c/li\u003e\n\u003cli\u003eIncreased deadlock risk.\u003c/li\u003e\n\u003cli\u003eReduced responsiveness.\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch4\u003e\n  \u003ca name=\"use-case\" href=\"#use-case\"\u003e\n  \u003c/a\u003e\n  Use Case:\n\u003c/h4\u003e\n\n\u003cp\u003ePessimistic locking is often employed in scenarios where conflicts are likely or must be avoided, such as:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eBanking systems where transactions involving account balances must be processed serially.\u003c/li\u003e\n\u003cli\u003eReservation systems where concurrent bookings for the same resource must be prevented.\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"optimistic-lock\" href=\"#optimistic-lock\"\u003e\n  \u003c/a\u003e\n  Optimistic lock\n\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003eREAD\u003c/li\u003e\n\u003cli\u003eLOCK\u003c/li\u003e\n\u003cli\u003eUPDATE\u003c/li\u003e\n\u003cli\u003eUNLOCK\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eExample:\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight sql\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e-- Check current version of the product\u003c/span\u003e\n\u003cspan class=\"k\"\u003eSELECT\u003c/span\u003e \u003cspan class=\"k\"\u003eversion\u003c/span\u003e \u003cspan class=\"k\"\u003eFROM\u003c/span\u003e \u003cspan class=\"n\"\u003eproducts\u003c/span\u003e \u003cspan class=\"k\"\u003eWHERE\u003c/span\u003e \u003cspan class=\"n\"\u003eproduct_id\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e-- Update product price (assuming version 1)\u003c/span\u003e\n\u003cspan class=\"k\"\u003eUPDATE\u003c/span\u003e \u003cspan class=\"n\"\u003eproducts\u003c/span\u003e\n\u003cspan class=\"k\"\u003eSET\u003c/span\u003e \u003cspan class=\"n\"\u003eprice\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e1200\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"mi\"\u003e00\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eversion\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eversion\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n\u003cspan class=\"k\"\u003eWHERE\u003c/span\u003e \u003cspan class=\"n\"\u003eproduct_id\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"k\"\u003eAND\u003c/span\u003e \u003cspan class=\"k\"\u003eversion\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e-- Retry if update count is zero\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003ch4\u003e\n  \u003ca name=\"pros\" href=\"#pros\"\u003e\n  \u003c/a\u003e\n  PROs:\n\u003c/h4\u003e\n\n\u003cul\u003e\n\u003cli\u003eMinimal performance impact.\u003c/li\u003e\n\u003cli\u003eAllows concurrent access.\u003c/li\u003e\n\u003cli\u003eSuitable for infrequent conflicts.\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch4\u003e\n  \u003ca name=\"cons\" href=\"#cons\"\u003e\n  \u003c/a\u003e\n  CONs:\n\u003c/h4\u003e\n\n\u003cul\u003e\n\u003cli\u003eRisk of conflicts.\u003c/li\u003e\n\u003cli\u003eRequires conflict resolution. (retry)\u003c/li\u003e\n\u003cli\u003eNot ideal for high contention.\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch4\u003e\n  \u003ca name=\"use-case\" href=\"#use-case\"\u003e\n  \u003c/a\u003e\n  Use Case\n\u003c/h4\u003e\n\n\u003cp\u003eOptimistic locking is commonly used in scenarios where the likelihood of conflicts is low, such as:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eContent management systems where users rarely edit the same document simultaneously.\u003c/li\u003e\n\u003cli\u003eE-commerce platforms where product prices are updated infrequently.\u003c/li\u003e\n\u003c/ul\u003e\n\n","thumbnail":"","author":{"id":"jacktt","name":"JackTT"},"created_at":"2024-05-08T10:10:31Z","updated_at":null,"tags":[]}